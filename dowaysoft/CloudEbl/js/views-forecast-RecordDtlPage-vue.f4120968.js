(window["webpackJsonp_cloud-ebl-app"]=window["webpackJsonp_cloud-ebl-app"]||[]).push([["views-forecast-RecordDtlPage-vue"],{"05ca":function(e,t,o){"use strict";o.r(t);o("b0c0");var c=o("7a23"),n=Object(c["withScopeId"])("data-v-4898cfbc");Object(c["pushScopeId"])("data-v-4898cfbc");var a={class:"page_header"},r=Object(c["createTextVNode"])("发送"),s=Object(c["createTextVNode"])("保存为草稿"),i=Object(c["createTextVNode"])("确认"),d=Object(c["createTextVNode"])("驳回"),u={style:{float:"right"}},l=Object(c["createVNode"])("a",{href:"http://cloud.dowaycn.com/Gateway/EblService/api/v1/forecast/forecastDown"},"下载模板",-1),f=Object(c["createTextVNode"])("上传文件"),p={class:"page_body"},b={class:"page_box"},m=Object(c["createVNode"])("span",{class:"title"},"基本信息",-1),h=Object(c["createVNode"])("hr",{style:{border:"0",background:"#dadada",height:"1px"}},null,-1),v={key:1},j={class:"page_box"},O=Object(c["createVNode"])("span",{class:"title"},"物料明细",-1),g=Object(c["createTextVNode"])(" 添加明细 "),y=Object(c["createVNode"])("hr",{style:{border:"0",background:"#dadada",height:"1px"}},null,-1);Object(c["popScopeId"])();var w=n((function(e,t,o,w,N,S){var k=Object(c["resolveComponent"])("a-button"),V=Object(c["resolveComponent"])("a-upload"),C=Object(c["resolveComponent"])("a-input"),x=Object(c["resolveComponent"])("a-form-item"),D=Object(c["resolveComponent"])("a-date-picker"),B=Object(c["resolveComponent"])("a-select-option"),L=Object(c["resolveComponent"])("a-select"),_=Object(c["resolveComponent"])("a-form"),R=Object(c["resolveComponent"])("BaseTableEditable"),T=Object(c["resolveComponent"])("a-textarea"),q=Object(c["resolveComponent"])("a-modal");return Object(c["openBlock"])(),Object(c["createBlock"])(c["Fragment"],null,[Object(c["createVNode"])("div",a,[Object(c["withDirectives"])(Object(c["createVNode"])(k,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:e.send},{default:n((function(){return[r]})),_:1},8,["loading","onClick"]),[[c["vShow"],("send"===e.type||void 0!==e.id)&&"草稿"===e.forecast.status]]),Object(c["withDirectives"])(Object(c["createVNode"])(k,{loading:e.saveLoading,style:{color:"#5259e5",border:"1px solid #5259e5"},onClick:e.saveAsDraft},{default:n((function(){return[s]})),_:1},8,["loading","onClick"]),[[c["vShow"],void 0===e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(k,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:t[1]||(t[1]=function(t){return e.handleReceivedForecastOrder("adopt")})},{default:n((function(){return[i]})),_:1},8,["loading"]),[[c["vShow"],"receive"===e.type&&void 0!==e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(k,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:t[2]||(t[2]=function(t){return e.rejectReasonVisible=!0})},{default:n((function(){return[d]})),_:1},8,["loading"]),[[c["vShow"],"receive"===e.type&&void 0!==e.id]]),Object(c["createVNode"])("div",u,[Object(c["withDirectives"])(Object(c["createVNode"])(k,{style:{"margin-right":"10px"}},{default:n((function(){return[l]})),_:1},512),[[c["vShow"],void 0===e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(V,{action:"",multiple:!0,"file-list":e.fileList,"auto-upload":!1,limit:1,customRequest:e.importWordConfirm},{default:n((function(){return[Object(c["createVNode"])(k,{style:{color:"#5259e5",border:"1px solid #5259e5"}},{default:n((function(){return[f]})),_:1})]})),_:1},8,["file-list","customRequest"]),[[c["vShow"],void 0===e.id]])])]),Object(c["createVNode"])("div",p,[Object(c["createVNode"])("div",b,[m,h,Object(c["createVNode"])(_,{ref:"forecastBaseForm",model:e.forecast,rules:e.rules,layout:"inline","label-col":{offset:1,span:5},"wrapper-col":{offset:1,span:17}},{default:n((function(){return[Object(c["createVNode"])(x,{label:"预测编码",name:"code","has-feedback":"",style:{width:"31%"}},{default:n((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(C,{value:e.forecast.code,"onUpdate:value":t[3]||(t[3]=function(t){return e.forecast.code=t}),placeholder:"请输入预测编码"},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.forecast.code),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(x,{label:"预测日期",name:"forecastTime","has-feedback":"",style:{width:"31%"}},{default:n((function(){return["edit"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])(D,{key:0,value:e.forecast.forecastTime,"onUpdate:value":t[4]||(t[4]=function(t){return e.forecast.forecastTime=t}),placeholder:"请选择日期",style:{width:"100%"}},null,8,["value"])):Object(c["createCommentVNode"])("",!0),"view"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])("span",v,Object(c["toDisplayString"])(e.dateFormat(e.forecast.forecastTime)),1)):Object(c["createCommentVNode"])("",!0)]})),_:1}),Object(c["createVNode"])(x,{label:"客户名称",name:"customerName","has-feedback":"",style:{width:"31%"}},{default:n((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(C,{value:e.forecast.customerName,"onUpdate:value":t[5]||(t[5]=function(t){return e.forecast.customerName=t}),placeholder:"请输入客户名称"},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.forecast.customerName),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(x,{label:"供应商",name:"supplierName",required:"","has-feedback":"",style:{width:"31%"}},{default:n((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])("div",null,[Object(c["createVNode"])(L,{value:e.forecast.supplierName,"onUpdate:value":t[6]||(t[6]=function(t){return e.forecast.supplierName=t}),placeholder:"请选择供应商名称","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":"无匹配项",style:{width:"100%"},onFocus:e.focusHandler,onSearch:e.handleSupplierSearch,onSelect:e.handleSupplierSelect},{default:n((function(){return[(Object(c["openBlock"])(!0),Object(c["createBlock"])(c["Fragment"],null,Object(c["renderList"])(e.supplies,(function(e){return Object(c["openBlock"])(),Object(c["createBlock"])(B,{key:e.id},{default:n((function(){return[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.name),1)]})),_:2},1024)})),128))]})),_:1},8,["value","onFocus","onSearch","onSelect"])],512),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.forecast.supplierName),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(x,{label:"信用代码",name:"supplierBusinessLicense","has-feedback":"",style:{width:"31%"}},{default:n((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(C,{disabled:"",value:e.forecast.supplierBusinessLicense,"onUpdate:value":t[7]||(t[7]=function(t){return e.forecast.supplierBusinessLicense=t})},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.forecast.supplierBusinessLicense),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1})]})),_:1},8,["model","rules"])]),Object(c["createVNode"])("div",j,[O,Object(c["withDirectives"])(Object(c["createVNode"])(k,{style:{float:"right",color:"#5259e5",border:"1px solid #5259e5"},onClick:e.addMat},{default:n((function(){return[g]})),_:1},8,["onClick"]),[[c["vShow"],void 0===e.id]]),y,Object(c["createVNode"])(R,{columns:e.columns,sourceData:e.forecastMats,editableCols:void 0===e.id&&"edit"===e.sysStatus?e.editableCols:[],onRowEdit:e.rowEditHandler,onCancelEdit:e.cancelEditHandler,onRowDelete:e.rowDeleteHandler},null,8,["columns","sourceData","editableCols","onRowEdit","onCancelEdit","onRowDelete"])])]),Object(c["createVNode"])(q,{visible:e.rejectReasonVisible,"onUpdate:visible":t[9]||(t[9]=function(t){return e.rejectReasonVisible=t}),centered:"",closable:!1,"mask-closable":!1,onOk:t[10]||(t[10]=function(t){return e.handleReceivedForecastOrder("reject")}),okText:"确定",cancelText:"取消"},{default:n((function(){return[Object(c["createVNode"])(T,{value:e.reason,"onUpdate:value":t[8]||(t[8]=function(t){return e.reason=t}),placeholder:"请输入驳回原因",rows:8},null,8,["value"])]})),_:1},8,["visible"])],64)})),N=(o("7db0"),o("4160"),o("a434"),o("d3b7"),o("159b"),o("368b"),o("56cd")),S=(o("7a59"),o("39ab")),k=(o("519e"),o("0bb7")),V=(o("04f3"),o("ed3b")),C=(o("e1f5"),o("5efb")),x=o("c1df"),D=o.n(x),B=o("c29c"),L=o("9096"),_=o("d649"),R=o("3f6c"),T=Object(c["defineComponent"])({components:{"a-button":C["a"],"a-modal":V["a"],"a-date-picker":k["a"],"a-upload":S["a"],BaseTableEditable:L["a"]},setup:function(){var e=Object(c["ref"])("view"),t=Object(c["ref"])(!1),o=Object(c["ref"])(!1),n=function(e,t,o){return null===t?Promise.reject(e.message):Promise.resolve()},a=Object(c["reactive"])([{title:"序号",dataIndex:"key",key:"key",slots:{customRender:"key"},width:70},{title:"物料编码",dataIndex:"code",key:"code",ellipsis:!0,slots:{customRender:"code"}},{title:"规格型号",dataIndex:"name",key:"name",ellipsis:!0,slots:{customRender:"name"}},{title:"预计数量",dataIndex:"qty",key:"qty",ellipsis:!0,slots:{customRender:"qty"}},{title:"操作",dataIndex:"operation",key:"operation",slots:{customRender:"operation"}}]),r=Object(c["reactive"])({orderCode:[{required:!0,message:"预测编码不能为空",trigger:"blur"}],purDate:[{validator:n,message:"预测日期不能为空",trigger:"blur"},{validator:n,message:"预测日期不能为空",trigger:"change"}],customerName:[{validator:n,message:"客户名称不能为空",trigger:"blur"}],supplierName:[{validator:n,message:"供应商名称不能为空",trigger:"blur"}]}),s=Object(c["reactive"])({id:"",code:"",forecastTime:D()(),customerName:"",customerBusinessLicense:"",supplierName:void 0,supplierBusinessLicense:"",authorizationCode:"",forecastMats:[],rowVersion:"",status:"draft"}),i=Object(c["reactive"])([]),d=["code","name","qty"],u=Object(c["ref"])([]),l=function(){i.push({key:String(i.length+1),id:"",code:"",name:"",qty:"",editable:!0})},f=Object(c["reactive"])({key:"",id:"",code:"",name:"",qty:""}),p=function(e){f.code=e.code,f.name=e.name,f.qty=e.qty},b=function(e){i.forEach((function(t,o,c){t.key===e&&(c[o].code=f.code,c[o].name=f.name,c[o].qty=f.qty)}))},m=function(e){i.forEach((function(t,o,c){t.key===e&&c.splice(o,1)}))},h=Object(c["ref"])(!1),v=Object(c["ref"])(""),j=function(){""===s.supplierBusinessLicense?N["a"].error({message:"错误",description:"未填写供应商信用代码，无法识别当前供应商，请完善供应商信息，并重新选取供应商"}):""===s.authorizationCode?N["a"].error({message:"错误",description:"当前所选供应商还不是您的合作伙伴"}):V["a"].confirm({title:"请确认",content:"确定要发送当前采购单吗？",cancelText:"取消",okText:"确认",onOk:function(){o.value=!0,Object(B["j"])([s.id]).then((function(e){200===e.code&&N["a"].success({message:"成功",description:"发送成功"})})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){o.value=!1}))}})};return{sysStatus:e,saveLoading:t,optLoading:o,columns:a,rules:r,forecast:s,forecastMats:i,editableCols:d,fileList:u,addMat:l,rowEditHandler:p,cancelEditHandler:b,rowDeleteHandler:m,rejectReasonVisible:h,send:j,reason:v}},data:function(){return{id:this.$route.query.id,type:this.$route.query.type,supplies:[]}},created:function(){void 0!==this.id&&void 0!==this.type?(this.getData(String(this.id),String(this.type)),this.sysStatus="view"):(this.loadTenant(),this.sysStatus="edit")},methods:{getForecast:function(e){var t=this;Object(B["e"])({id:e}).then((function(e){t.forecast.id=e.content.id,t.forecast.code=e.content.code,t.forecast.forecastTime=e.content.forecastTime,t.forecast.customerName=e.content.customerName,t.forecast.customerBusinessLicense=e.content.customerBusinessLicense,t.forecast.supplierName=e.content.supplierName,t.forecast.supplierBusinessLicense=e.content.supplierBusinessLicense,t.forecast.authorizationCode=e.content.authorizationCode,t.forecast.status=t.textFormat(e.content.status),e.content.forecastMats.forEach((function(e){t.forecastMats.push({key:String(t.forecastMats.length+1),id:e.id,code:e.code,name:e.name,qty:e.qty})}))})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))},getForecastReceived:function(e){var t=this;Object(B["f"])({id:e}).then((function(e){t.forecast.id=e.content.id,t.forecast.code=e.content.code,t.forecast.forecastTime=e.content.forecastTime,t.forecast.customerName=e.content.customerName,t.forecast.customerBusinessLicense=e.content.customerBusinessLicense,t.forecast.supplierName=e.content.supplierName,t.forecast.supplierBusinessLicense=e.content.supplierBusinessLicense,t.forecast.authorizationCode=e.content.authorizationCode,t.forecast.status=t.textFormat(e.content.status),e.content.forecastMats.forEach((function(e){t.forecastMats.push({key:String(t.forecastMats.length+1),id:e.id,code:e.code,name:e.name,qty:e.qty})}))})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))},getData:function(e,t){"send"===t?this.getForecast(e):"receive"===t&&this.getForecastReceived(e)},loadTenant:function(){var e=this;Object(R["a"])({id:localStorage.getItem("doway_cloud_tenant_id")}).then((function(t){200===t.code&&(e.forecast.customerName=t.content.name,e.forecast.customerBusinessLicense=t.content.creditCode,t.content.director&&t.content.tel||N["a"].warning({message:"警告",description:"当前租户负责人或联系方式信息缺失，请到信息设置中完善"}))})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))},focusHandler:function(){var e=this;Object(_["c"])().then((function(t){e.supplies=t.content})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))},handleSupplierSelect:function(e){var t=this.supplies.find((function(t){return t.id===e}));this.forecast.supplierName=t.name,this.forecast.supplierBusinessLicense=t.businessLicense,t.authorizationCode||N["a"].warning({message:"警告",description:"未检测到与所选供应商的交易关系，请到供应商信息页检查"}),this.forecast.authorizationCode=t.authorizationCode},handleSupplierSearch:function(e){var t=this;t.supplies=[],Object(_["a"])({name:e}).then((function(e){t.supplies=e.content})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))},saveAsDraft:function(){var e=this,t=e.$refs.forecastBaseForm;t.validate().then((function(){e.forecast.forecastMats=e.forecastMats;var o=[];o.push(e.forecast),e.saveLoading=!0,Object(B["a"])(o).then((function(o){t.resetFields(),e.forecastMats.splice(0),e.loadTenant(),N["a"].success({message:"成功",description:"添加成功"})})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){e.saveLoading=!1}))})).catch((function(e){console.debug(e)}))},handleReceivedForecastOrder:function(e){var t=this,o={ids:[t.forecast.id],result:e,reason:t.reason};t.optLoading=!0,Object(B["d"])(o).then((function(e){200===e.code&&(t.getData(String(t.id),String(t.type)),t.rejectReasonVisible=!1,N["a"].success({message:"成功",description:"已处理"}))})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.optLoading=!1}))},textFormat:function(e){switch(e){case"draft":return"草稿";case"published":return"已发布";case"confirmed":return"已确认";case"rejected":return"已驳回";case"untreated":return"未处理";default:return e}},dateFormat:function(e){return D()(e).format("YYYY-MM-DD")},importWordConfirm:function(e){var t=e.file,o=new FormData;o.append("file",t),Object(B["b"])(o).then((function(e){N["a"].success({message:"成功",description:"数据导入成功，请至采购记录页面查看"})})).catch((function(e){N["a"].error({message:"错误",description:e}),console.debug(e)}))}}});o("cd2e"),o("bd5c");T.render=w,T.__scopeId="data-v-4898cfbc";t["default"]=T},"7c82":function(e,t,o){},9644:function(e,t,o){},bd5c:function(e,t,o){"use strict";o("9644")},c29c:function(e,t,o){"use strict";o.d(t,"e",(function(){return a})),o.d(t,"f",(function(){return r})),o.d(t,"c",(function(){return s})),o.d(t,"g",(function(){return i})),o.d(t,"h",(function(){return d})),o.d(t,"i",(function(){return u})),o.d(t,"a",(function(){return l})),o.d(t,"j",(function(){return f})),o.d(t,"d",(function(){return p})),o.d(t,"b",(function(){return b}));var c=o("b32d"),n="http://cloud.dowaycn.com/Gateway/EblService/api/v1/forecast";function a(e){return Object(c["a"])({url:n+"/loadById",method:"get",params:e})}function r(e){return Object(c["a"])({url:n+"/loadByIdReceived",method:"get",params:e})}function s(){return Object(c["a"])({url:n+"/queryAll",method:"get"})}function i(){return Object(c["a"])({url:n+"/queryAllReceived",method:"get"})}function d(e){return Object(c["a"])({url:n+"/searchByExp",method:"post",data:e})}function u(e){return Object(c["a"])({url:n+"/searchReceivedByExp",method:"post",data:e})}function l(e){return Object(c["a"])({url:n+"/adds",method:"post",data:e})}function f(e){return Object(c["a"])({url:n+"/sendForecast",method:"post",data:e})}function p(e){return Object(c["a"])({url:n+"/handleReceivedForecast",method:"post",data:e})}function b(e){return Object(c["a"])({url:n+"/forecastImport",method:"post",data:e})}},cd2e:function(e,t,o){"use strict";o("7c82")},d649:function(e,t,o){"use strict";o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return s}));var c=o("b32d"),n="http://cloud.dowaycn.com/Gateway/BaseService/api/v1/supplier";function a(e){return Object(c["a"])({url:n+"/loadByName",method:"get",params:e})}function r(e){return Object(c["a"])({url:n+"/queryAllContacts",method:"get",params:e})}function s(){return Object(c["a"])({url:n+"/query",method:"get"})}}}]);