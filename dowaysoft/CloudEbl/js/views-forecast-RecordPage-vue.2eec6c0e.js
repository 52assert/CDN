(window["webpackJsonp_cloud-ebl-app"]=window["webpackJsonp_cloud-ebl-app"]||[]).push([["views-forecast-RecordPage-vue"],{"04c9":function(e,t,c){},1815:function(e,t,c){"use strict";c("b550"),c("d79d")},"50ac":function(e,t,c){"use strict";c("b550"),c("d79d")},"844a":function(e,t,c){"use strict";c.r(t);var n=c("7a23"),a=Object(n["createTextVNode"])(" 发送 "),o=Object(n["createTextVNode"])(" 预测编码 "),r=Object(n["createTextVNode"])(" 供应商名称 "),s=Object(n["createTextVNode"])(" 确认 "),i=Object(n["createTextVNode"])(" 驳回 "),u=Object(n["createTextVNode"])(" 预测编码 "),d=Object(n["createTextVNode"])(" 供应商名称 ");function l(e,t,c,l,p,h){var f=Object(n["resolveComponent"])("a-button"),b=Object(n["resolveComponent"])("a-col"),m=Object(n["resolveComponent"])("a-select-option"),j=Object(n["resolveComponent"])("a-select"),O=Object(n["resolveComponent"])("a-input-search"),v=Object(n["resolveComponent"])("a-input-group"),y=Object(n["resolveComponent"])("a-row"),x=Object(n["resolveComponent"])("BaseTableEditable"),g=Object(n["resolveComponent"])("a-spin"),C=Object(n["resolveComponent"])("a-tab-pane"),w=Object(n["resolveComponent"])("a-tabs"),N=Object(n["resolveComponent"])("a-textarea"),V=Object(n["resolveComponent"])("a-modal");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(w,{activeKey:e.currentKey,"onUpdate:activeKey":t[7]||(t[7]=function(t){return e.currentKey=t})},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(C,{key:"send",tab:"我发送的"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(y,{class:"header"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(b,{span:10},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{disabled:0===e.ids.length,loading:e.optLoading,type:"primary",style:{margin:"0px 10px 10px 10px"},onClick:e.send},{default:Object(n["withCtx"])((function(){return[a]})),_:1},8,["disabled","loading","onClick"])]})),_:1}),Object(n["createVNode"])(b,{span:14,style:{"margin-bottom":"10px"}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(v,{compact:""},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{value:e.searchType,"onUpdate:value":t[1]||(t[1]=function(t){return e.searchType=t}),placeholder:"选择搜索条件",style:{width:"110px"},onChange:e.handleSelectChange},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(m,{value:"code"},{default:Object(n["withCtx"])((function(){return[o]})),_:1}),Object(n["createVNode"])(m,{value:"supply_name"},{default:Object(n["withCtx"])((function(){return[r]})),_:1})]})),_:1},8,["value","onChange"]),Object(n["createVNode"])(O,{value:e.searchExp,"onUpdate:value":t[2]||(t[2]=function(t){return e.searchExp=t}),style:{width:"80%"},placeholder:"请输入搜索内容","enter-button":"",onSearch:e.onSearch},null,8,["value","onSearch"])]})),_:1})]})),_:1})]})),_:1}),Object(n["createVNode"])(g,{spinning:e.listLoading},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(x,{columns:e.columns,sourceData:e.souceData,selectedKeys:e.selectedKeys,destPath:"/forecastRecordDtl",type:"send",onSelected:e.setIds},null,8,["columns","sourceData","selectedKeys","onSelected"])]})),_:1},8,["spinning"])]})),_:1}),Object(n["createVNode"])(C,{key:"receive",tab:"我接收的"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(y,{class:"header"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(b,{span:10},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{disabled:0===e.ids.length,loading:e.optLoading,type:"primary",style:{margin:"0px 10px 10px 10px"},onClick:t[3]||(t[3]=function(t){return e.handleReceivedForecastOrder("adopt")})},{default:Object(n["withCtx"])((function(){return[s]})),_:1},8,["disabled","loading"]),Object(n["createVNode"])(f,{disabled:0===e.ids.length,loading:e.optLoading,type:"primary",style:{margin:"0px 10px 10px 10px"},onClick:t[4]||(t[4]=function(t){return e.rejectReasonModal=!0})},{default:Object(n["withCtx"])((function(){return[i]})),_:1},8,["disabled","loading"])]})),_:1}),Object(n["createVNode"])(b,{span:14},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(v,{compact:""},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{value:e.searchReceivedType,"onUpdate:value":t[5]||(t[5]=function(t){return e.searchReceivedType=t}),placeholder:"选择搜索条件",style:{width:"110px"},onChange:e.handleSelectChange},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(m,{value:"code"},{default:Object(n["withCtx"])((function(){return[u]})),_:1}),Object(n["createVNode"])(m,{value:"supply_name"},{default:Object(n["withCtx"])((function(){return[d]})),_:1})]})),_:1},8,["value","onChange"]),Object(n["createVNode"])(O,{value:e.searchExp,"onUpdate:value":t[6]||(t[6]=function(t){return e.searchExp=t}),style:{width:"80%"},placeholder:"请输入搜索内容","enter-button":"",onSearch:e.onSearch},null,8,["value","onSearch"])]})),_:1})]})),_:1})]})),_:1}),Object(n["createVNode"])(g,{spinning:e.listLoading},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(x,{columns:e.columns,sourceData:e.souceReceivedData,selectedKeys:e.selectedKeys,destPath:"/forecastRecordDtl",type:"receive",onSelected:e.setIds},null,8,["columns","sourceData","selectedKeys","onSelected"])]})),_:1},8,["spinning"])]})),_:1})]})),_:1},8,["activeKey"]),Object(n["createVNode"])(V,{visible:e.rejectReasonModal,"onUpdate:visible":t[9]||(t[9]=function(t){return e.rejectReasonModal=t}),centered:"",closable:!1,"mask-closable":!1,onOk:t[10]||(t[10]=function(t){return e.handleReceivedForecastOrder("reject")}),okText:"确定",cancelText:"取消"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(N,{value:e.reason,"onUpdate:value":t[8]||(t[8]=function(t){return e.reason=t}),placeholder:"请输入驳回原因",rows:8},null,8,["value"])]})),_:1},8,["visible"])],64)}c("4160"),c("a434"),c("d3b7"),c("159b"),c("368b");var p=c("56cd"),h=(c("04f3"),c("ed3b")),f=(c("1815"),c("e32c")),b=(c("50ac"),c("9a63")),m=(c("e1f5"),c("5efb")),j=c("9096"),O=c("c29c"),v=c("5f70"),y=c.n(v),x=Object(n["defineComponent"])({components:{"a-button":m["a"],"a-row":b["a"],"a-col":f["a"],"a-modal":h["a"],BaseTableEditable:j["a"]},setup:function(){var e=Object(n["ref"])(!1),t=Object(n["ref"])(!1),c=Object(n["ref"])("send"),a=Object(n["ref"])(""),o=Object(n["ref"])(""),r=Object(n["ref"])(""),s=Object(n["reactive"])([]),i=Object(n["reactive"])([]),u=Object(n["reactive"])([{title:"序号",dataIndex:"key",key:"key",width:70},{title:"预测编码",dataIndex:"code",key:"code"},{title:"预计时间",dataIndex:"forecastTime",key:"forecastTime"},{title:"客户名称",dataIndex:"customerName",key:"customerName",ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",ellipsis:!0},{title:"操作",dataIndex:"operation",key:"operation",slots:{customRender:"operation"}}]),d=Object(n["reactive"])([]),l=Object(n["reactive"])([]),h=Object(n["ref"])(!1),f=Object(n["ref"])(""),b=function(e){switch(e){case"draft":return"草稿";case"published":return"已发送";case"confirmed":return"已确认";case"rejected":return"已驳回";case"untreated":return"未处理";default:return e}},m=function(){t.value=!0,Object(O["c"])().then((function(e){d.splice(0),e.content.forEach((function(e){d.push({key:String(d.length+1),id:e.id,code:e.code,forecastTime:y()(e.forecastTime).format("YYYY-MM-DD"),customerName:e.customerName,customerBusinessLicense:e.customerBusinessLicense,supplierName:e.supplierName,supplierBusinessLicense:e.supplierBusinessLicense,authorizationCode:e.authorizationCode,status:b(e.status),rowVersion:e.rowVersion})}))})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.value=!1}))},j=function(){t.value=!0,Object(O["g"])().then((function(e){l.splice(0),e.content.forEach((function(e){l.push({key:String(d.length+1),id:e.id,code:e.code,forecastTime:y()(e.forecastTime).format("YYYY-MM-DD"),customerName:e.customerName,customerBusinessLicense:e.customerBusinessLicense,supplierName:e.supplierName,supplierBusinessLicense:e.supplierBusinessLicense,authorizationCode:e.authorizationCode,status:b(e.status),rowVersion:e.rowVersion})}))})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.value=!1}))},v=function(e,t){Object(O["h"])({expCondition:e,expContent:t}).then((function(e){d.splice(0),e.content.forEach((function(e){d.push({key:String(d.length+1),id:e.id,code:e.code,forecastTime:y()(e.forecastTime).format("YYYY-MM-DD"),customerName:e.customerName,customerBusinessLicense:e.customerBusinessLicense,supplierName:e.supplierName,supplierBusinessLicense:e.supplierBusinessLicense,authorizationCode:e.authorizationCode,status:b(e.status),rowVersion:e.rowVersion})}))})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)}))},x=function(e,t){Object(O["i"])({expCondition:e,expContent:t}).then((function(e){l.splice(0),e.content.forEach((function(e){l.push({key:String(d.length+1),id:e.id,code:e.code,forecastTime:y()(e.forecastTime).format("YYYY-MM-DD"),customerName:e.customerName,customerBusinessLicense:e.customerBusinessLicense,supplierName:e.supplierName,supplierBusinessLicense:e.supplierBusinessLicense,authorizationCode:e.authorizationCode,status:b(e.status),rowVersion:e.rowVersion})}))})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)}))};return{optLoading:e,listLoading:t,currentKey:c,searchExp:r,searchType:a,searchReceivedType:o,ids:s,selectedKeys:i,columns:u,souceData:d,souceReceivedData:l,reason:f,rejectReasonModal:h,textFormat:b,getAllForecast:m,getAllReceivedForecast:j,searchForecastByExp:v,searchForecastReceivedByExp:x}},watch:{currentKey:{handler:function(e){switch(e){case"send":this.searchType="code",this.searchExp="",this.ids.splice(0),this.getAllForecast();break;case"receive":this.searchReceivedType="code",this.searchExp="",this.ids.splice(0),this.getAllReceivedForecast();break;default:break}},immediate:!0}},methods:{handleSelectChange:function(e,t){this.searchType=e},setIds:function(e){var t=this;t.ids.splice(0),t.selectedKeys.splice(0),null!==e&&(console.log(e),e.forEach((function(e){switch(t.currentKey){case"send":"草稿"!==e.status?p["a"].warning({message:"警告",description:"采购预测编码"+e.code+e.status+"，不能重复勾选"}):(t.ids.push(e.id),t.selectedKeys.push(e.key));break;case"receive":"未处理"!==e.status?p["a"].warning({message:"警告",description:"采购预测编码"+e.orderCode+e.status+"，不能重复勾选"}):(t.ids.push(e.id),t.selectedKeys.push(e.key));break;default:break}})))},onSearch:function(e){switch(this.currentKey){case"send":this.searchForecastByExp(this.searchType,this.searchExp);break;case"receive":this.searchForecastReceivedByExp(this.searchType,this.searchExp);break;default:break}},send:function(){var e=this;h["a"].confirm({title:"请确认",content:"确定要发送当前采购预测吗？",cancelText:"取消",okText:"确认",onOk:function(){e.optLoading=!0,Object(O["j"])(e.ids).then((function(t){"send"===e.currentKey?(e.searchType="code",e.searchExp="",e.ids.splice(0),e.getAllForecast()):"receive"===e.currentKey&&(e.searchReceivedType="code",e.searchExp="",e.ids.splice(0),e.getAllReceivedForecast()),200===t.code&&p["a"].success({message:"成功",description:"发送成功"})})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){e.optLoading=!1}))}})},handleReceivedForecastOrder:function(e){var t=this,c={ids:t.ids,result:e,reason:t.reason};Object(O["d"])(c).then((function(e){"send"===t.currentKey?(t.searchType="code",t.searchExp="",t.ids.splice(0),t.getAllForecast()):"receive"===t.currentKey&&(t.searchReceivedType="code",t.searchExp="",t.ids.splice(0),t.getAllReceivedForecast()),t.rejectReasonModal=!1,200===e.code&&p["a"].success({message:"成功",description:"已处理"})})).catch((function(e){p["a"].error({message:"错误",description:e}),console.debug(e)}))}}});c("9393");x.render=l;t["default"]=x},9393:function(e,t,c){"use strict";c("04c9")},"9a63":function(e,t,c){"use strict";var n=c("290c");n["a"].install=function(e){e.component(n["a"].name,n["a"])},t["a"]=n["a"]},c29c:function(e,t,c){"use strict";c.d(t,"e",(function(){return o})),c.d(t,"f",(function(){return r})),c.d(t,"c",(function(){return s})),c.d(t,"g",(function(){return i})),c.d(t,"h",(function(){return u})),c.d(t,"i",(function(){return d})),c.d(t,"a",(function(){return l})),c.d(t,"j",(function(){return p})),c.d(t,"d",(function(){return h})),c.d(t,"b",(function(){return f}));var n=c("b32d"),a="http://cloud.dowaycn.com/Gateway/EblService/api/v1/forecast";function o(e){return Object(n["a"])({url:a+"/loadById",method:"get",params:e})}function r(e){return Object(n["a"])({url:a+"/loadByIdReceived",method:"get",params:e})}function s(){return Object(n["a"])({url:a+"/queryAll",method:"get"})}function i(){return Object(n["a"])({url:a+"/queryAllReceived",method:"get"})}function u(e){return Object(n["a"])({url:a+"/searchByExp",method:"post",data:e})}function d(e){return Object(n["a"])({url:a+"/searchReceivedByExp",method:"post",data:e})}function l(e){return Object(n["a"])({url:a+"/adds",method:"post",data:e})}function p(e){return Object(n["a"])({url:a+"/sendForecast",method:"post",data:e})}function h(e){return Object(n["a"])({url:a+"/handleReceivedForecast",method:"post",data:e})}function f(e){return Object(n["a"])({url:a+"/forecastImport",method:"post",data:e})}},e32c:function(e,t,c){"use strict";var n=c("da05");n["b"].install=function(e){e.component(n["b"].name,n["b"])},t["a"]=n["b"]}}]);