(window["webpackJsonp_cloud-ebl-app"]=window["webpackJsonp_cloud-ebl-app"]||[]).push([["views-schedule-RecordDtlPage-vue"],{"0809":function(e,t,n){"use strict";n.r(t);var c=n("7a23"),o=Object(c["withScopeId"])("data-v-900ee862");Object(c["pushScopeId"])("data-v-900ee862");var r={class:"page_header"},a=Object(c["createTextVNode"])("发送"),s=Object(c["createTextVNode"])("作废"),d=Object(c["createTextVNode"])("保存为草稿"),i=Object(c["createTextVNode"])("确认"),u=Object(c["createTextVNode"])("驳回"),l={style:{float:"right"}},h=Object(c["createVNode"])("a",{href:"http://cloud.dowaycn.com/Gateway/EblService/api/v1/forecast/scheduleDown"},"下载模板",-1),f=Object(c["createTextVNode"])("上传文件"),p={class:"page_body"},b={class:"page_box"},m=Object(c["createVNode"])("span",{class:"title"},"基本信息",-1),v=Object(c["createVNode"])("hr",{style:{border:"0",background:"#dadada",height:"1px"}},null,-1),j={key:1};Object(c["popScopeId"])();var O=o((function(e,t,n,O,g,y){var w=Object(c["resolveComponent"])("a-button"),S=Object(c["resolveComponent"])("a-upload"),C=Object(c["resolveComponent"])("a-select-option"),k=Object(c["resolveComponent"])("a-select"),N=Object(c["resolveComponent"])("a-form-item"),V=Object(c["resolveComponent"])("a-input"),B=Object(c["resolveComponent"])("a-date-picker"),D=Object(c["resolveComponent"])("a-form"),x=Object(c["resolveComponent"])("a-spin"),L=Object(c["resolveComponent"])("a-textarea"),_=Object(c["resolveComponent"])("a-modal");return Object(c["openBlock"])(),Object(c["createBlock"])(c["Fragment"],null,[Object(c["createVNode"])("div",r,[Object(c["withDirectives"])(Object(c["createVNode"])(w,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:e.send},{default:o((function(){return[a]})),_:1},8,["loading","onClick"]),[[c["vShow"],("send"===e.type||void 0!==e.id)&&"草稿"===e.schedule.status]]),Object(c["withDirectives"])(Object(c["createVNode"])(w,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:e.invalidSchedule},{default:o((function(){return[s]})),_:1},8,["loading","onClick"]),[[c["vShow"],"send"===e.type&&void 0!==e.id&&("草稿"===e.schedule.status||"已驳回"===e.schedule.status)]]),Object(c["withDirectives"])(Object(c["createVNode"])(w,{style:{color:"#5259e5",border:"1px solid #5259e5"},onClick:e.saveAsDraft},{default:o((function(){return[d]})),_:1},8,["onClick"]),[[c["vShow"],void 0===e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(w,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:t[1]||(t[1]=function(t){return e.handleReceivedScheduleOrder("adopt")})},{default:o((function(){return[i]})),_:1},8,["loading"]),[[c["vShow"],"receive"===e.type&&void 0!==e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(w,{loading:e.optLoading,style:{background:"#5259e5",border:"0px",color:"#fff",margin:"0px 10px"},onClick:t[2]||(t[2]=function(t){return e.rejectReasonVisible=!0})},{default:o((function(){return[u]})),_:1},8,["loading"]),[[c["vShow"],"receive"===e.type&&void 0!==e.id]]),Object(c["createVNode"])("div",l,[Object(c["withDirectives"])(Object(c["createVNode"])(w,{style:{"margin-right":"10px"}},{default:o((function(){return[h]})),_:1},512),[[c["vShow"],void 0===e.id]]),Object(c["withDirectives"])(Object(c["createVNode"])(S,{action:"",multiple:!0,"file-list":e.fileList,"auto-upload":!1,limit:1,customRequest:e.importWordConfirm},{default:o((function(){return[Object(c["createVNode"])(w,{style:{color:"#5259e5",border:"1px solid #5259e5"}},{default:o((function(){return[f]})),_:1})]})),_:1},8,["file-list","customRequest"]),[[c["vShow"],void 0===e.id]])])]),Object(c["createVNode"])(x,{spinning:e.loading},{default:o((function(){return[Object(c["createVNode"])("div",p,[Object(c["createVNode"])("div",b,[m,v,Object(c["createVNode"])(D,{ref:"scheduleBaseForm",model:e.schedule,rules:e.rules,layout:"inline","label-col":{offset:1,span:5},"wrapper-col":{offset:1,span:17}},{default:o((function(){return[Object(c["createVNode"])(N,{label:"订单号",name:"ordCode","has-feedback":"",style:{width:"31%"}},{default:o((function(){return["edit"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])(k,{key:0,value:e.schedule.ordCode,"onUpdate:value":t[3]||(t[3]=function(t){return e.schedule.ordCode=t}),placeholder:"请选择供应商名称","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":"无匹配项",style:{width:"100%"},onFocus:e.focusHandler,onSearch:e.handlePurchaseSearch,onSelect:e.handlePurchaseSelect},{default:o((function(){return[(Object(c["openBlock"])(!0),Object(c["createBlock"])(c["Fragment"],null,Object(c["renderList"])(e.purchases,(function(e){return Object(c["openBlock"])(),Object(c["createBlock"])(C,{key:e.id},{default:o((function(){return[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.orderCode),1)]})),_:2},1024)})),128))]})),_:1},8,["value","onFocus","onSearch","onSelect"])):Object(c["createCommentVNode"])("",!0),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.schedule.ordCode),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(N,{label:"信用代码",name:"supplierBusinessLicense","has-feedback":"",style:{width:"31%"}},{default:o((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(V,{disabled:"",value:e.schedule.supplierBusinessLicense,"onUpdate:value":t[4]||(t[4]=function(t){return e.schedule.supplierBusinessLicense=t})},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.schedule.supplierBusinessLicense),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(N,{label:"物料编码",name:"matCode","has-feedback":"",style:{width:"31%"}},{default:o((function(){return["edit"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])(k,{key:0,value:e.schedule.matCode,"onUpdate:value":t[5]||(t[5]=function(t){return e.schedule.matCode=t}),placeholder:"请选择物料编码","show-search":"","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":"无匹配项",style:{width:"100%"},onFocus:e.focusPurchaseMatHandler,onSearch:e.handlePurchaseMatSearch,onSelect:e.handlePurchaseMatSelect},{default:o((function(){return[(Object(c["openBlock"])(!0),Object(c["createBlock"])(c["Fragment"],null,Object(c["renderList"])(e.purchaseMats,(function(e){return Object(c["openBlock"])(),Object(c["createBlock"])(C,{key:e.id},{default:o((function(){return[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.code),1)]})),_:2},1024)})),128))]})),_:1},8,["value","onFocus","onSearch","onSelect"])):Object(c["createCommentVNode"])("",!0),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.schedule.matCode),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(N,{label:"物料名称",name:"matName","has-feedback":"",style:{width:"31%"}},{default:o((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(V,{disabled:"",value:e.schedule.matName,"onUpdate:value":t[6]||(t[6]=function(t){return e.schedule.matName=t})},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.schedule.matName),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(N,{label:"数量",name:"qty","has-feedback":"",style:{width:"31%"}},{default:o((function(){return[Object(c["withDirectives"])(Object(c["createVNode"])(V,{value:e.schedule.qty,"onUpdate:value":t[7]||(t[7]=function(t){return e.schedule.qty=t}),placeholder:"请输入数量"},null,8,["value"]),[[c["vShow"],"edit"===e.sysStatus]]),Object(c["withDirectives"])(Object(c["createVNode"])("span",null,Object(c["toDisplayString"])(e.schedule.qty),513),[[c["vShow"],"view"===e.sysStatus]])]})),_:1}),Object(c["createVNode"])(N,{label:"交期",name:"deliveryDate","has-feedback":"",style:{width:"31%"}},{default:o((function(){return["edit"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])(B,{key:0,value:e.schedule.deliveryDate,"onUpdate:value":t[8]||(t[8]=function(t){return e.schedule.deliveryDate=t}),placeholder:"请选择日期",style:{width:"100%"}},null,8,["value"])):Object(c["createCommentVNode"])("",!0),"view"===e.sysStatus?(Object(c["openBlock"])(),Object(c["createBlock"])("span",j,Object(c["toDisplayString"])(e.dateFormat(e.schedule.deliveryDate)),1)):Object(c["createCommentVNode"])("",!0)]})),_:1})]})),_:1},8,["model","rules"])])])]})),_:1},8,["spinning"]),Object(c["createVNode"])(_,{visible:e.rejectReasonVisible,"onUpdate:visible":t[10]||(t[10]=function(t){return e.rejectReasonVisible=t}),centered:"",closable:!1,"mask-closable":!1,onOk:t[11]||(t[11]=function(t){return e.handleReceivedForecastOrder("reject")}),okText:"确定",cancelText:"取消"},{default:o((function(){return[Object(c["createVNode"])(L,{value:e.reason,"onUpdate:value":t[9]||(t[9]=function(t){return e.reason=t}),placeholder:"请输入驳回原因",rows:8},null,8,["value"])]})),_:1},8,["visible"])],64)})),g=(n("7db0"),n("b0c0"),n("d3b7"),n("368b"),n("56cd")),y=(n("519e"),n("0bb7")),w=(n("7a59"),n("39ab")),S=(n("04f3"),n("ed3b")),C=(n("e1f5"),n("5efb")),k=n("346c"),N=n("c1df"),V=n.n(N),B=n("3e16"),D=Object(c["defineComponent"])({components:{"a-button":C["a"],"a-modal":S["a"],"a-upload":w["a"],"a-date-picker":y["a"]},setup:function(){var e=Object(c["ref"])("view"),t=(Object(c["ref"])(!1),Object(c["ref"])(!1)),n=Object(c["ref"])(!1),o=Object(c["ref"])(),r=function(e,t,n){return null===t?Promise.reject(e.message):Promise.resolve()},a=Object(c["reactive"])({ordCode:[{required:!0,message:"订单号不能为空",trigger:"blur"}],matCode:[{required:!0,message:"物料编码不能为空",trigger:"blur"}],qty:[{validator:r,required:!0,message:"数量不能为空",trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"请输入正确的数量",trigger:"blur"}]}),s=Object(c["reactive"])({id:"",code:"",matCode:void 0,matName:"",deliveryDate:V()(),qty:"",ordId:"",ordCode:void 0,ordDtlId:"",rowVersion:"",rowType:"",authorizationCode:"",customerBusinessLicense:"",supplierBusinessLicense:"",status:"draft"}),d=function(){""===s.supplierBusinessLicense?g["a"].error({message:"错误",description:"未填写供应商信用代码，无法识别当前供应商，请完善供应商信息，并重新选取供应商"}):""===s.authorizationCode?g["a"].error({message:"错误",description:"当前所选供应商还不是您的合作伙伴"}):S["a"].confirm({title:"请确认",content:"确定要发送当前采购单吗？",cancelText:"取消",okText:"确认",onOk:function(){t.value=!0,Object(k["j"])([s.id]).then((function(e){200===e.code&&g["a"].success({message:"成功",description:"发送成功"})})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.value=!1}))}})},i=function(){s.status="invalid",t.value=!0,Object(k["k"])(s).then((function(e){200===e.code&&g["a"].success({message:"成功",description:"操作成功"})})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.value=!1}))},u=Object(c["ref"])(!1),l=Object(c["ref"])("");return{sysStatus:e,optLoading:t,loading:n,purchaseId:o,rules:a,schedule:s,send:d,invalidSchedule:i,rejectReasonVisible:u,reason:l}},data:function(){return{id:this.$route.query.id,type:this.$route.query.type,purchases:[],purchaseMats:[]}},created:function(){void 0!==this.id&&void 0!==this.type?(this.getData(String(this.id),String(this.type)),this.sysStatus="view"):this.sysStatus="edit"},methods:{getSchedule:function(e){var t=this;t.loading=!0,Object(k["d"])({id:e}).then((function(e){t.schedule.id=e.content.id,t.schedule.code=e.content.code,t.schedule.matCode=e.content.matCode,t.schedule.matName=e.content.matName,t.schedule.deliveryDate=e.content.deliveryDate,t.schedule.qty=e.content.qty,t.schedule.ordId=e.content.ordId,t.schedule.ordCode=e.content.ordCode,t.schedule.ordDtlId=e.content.ordDtlId,t.schedule.status=t.textFormat(e.content.status),t.schedule.authorizationCode=e.content.authorizationCode,t.schedule.customerBusinessLicense=e.content.customerBusinessLicense,t.schedule.supplierBusinessLicense=e.content.supplierBusinessLicense,t.schedule.rowType=e.content.rowType})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.loading=!1}))},getScheduleReceived:function(e){var t=this;t.loading=!0,Object(k["e"])({id:e}).then((function(e){t.schedule.id=e.content.id,t.schedule.code=e.content.code,t.schedule.matCode=e.content.matCode,t.schedule.matName=e.content.matName,t.schedule.deliveryDate=e.content.deliveryDate,t.schedule.qty=e.content.qty,t.schedule.ordId=e.content.ordId,t.schedule.ordCode=e.content.ordCode,t.schedule.ordDtlId=e.content.ordDtlId,t.schedule.status=t.textFormat(e.content.status),t.schedule.authorizationCode=e.content.authorizationCode,t.schedule.customerBusinessLicense=e.content.customerBusinessLicense,t.schedule.supplierBusinessLicense=e.content.supplierBusinessLicense,t.schedule.rowType=e.content.rowType})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.loading=!1}))},getData:function(e,t){"send"===t?this.getSchedule(e):"receive"===t&&this.getScheduleReceived(e)},focusHandler:function(){var e=this;Object(B["b"])().then((function(t){e.purchases=t.content})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)}))},handlePurchaseSearch:function(e){var t=this;t.purchases=[],Object(B["i"])({expCondition:"order_code",expContent:e}).then((function(e){t.purchases=e.content})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)}))},handlePurchaseSelect:function(e){var t=this,n=t.purchases.find((function(t){return t.id===e}));t.purchaseId=e,t.schedule.ordId=e,t.schedule.ordCode=n.orderCode,t.schedule.customerBusinessLicense=n.senderBusinessLicense,t.schedule.supplierBusinessLicense=n.businessLicense,n.authorizationCode||g["a"].warning({message:"警告",description:"未检测到与所选供应商的交易关系，请到供应商信息页检查"}),t.schedule.authorizationCode=n.authorizationCode},focusPurchaseMatHandler:function(){var e=this;void 0===e.purchaseId?g["a"].warning({message:"警告",description:"请先选择订单"}):Object(B["f"])({purchaseId:e.purchaseId}).then((function(t){e.purchaseMats=t.content})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)}))},handlePurchaseMatSearch:function(e){var t=this;t.purchaseMats=[],Object(B["j"])({expCondition:"code",expContent:e}).then((function(e){t.purchaseMats=e.content})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)}))},handlePurchaseMatSelect:function(e){var t=this.purchaseMats.find((function(t){return t.id===e}));this.schedule.ordDtlId=e,this.schedule.matName=t.name,this.schedule.qty=t.qty},saveAsDraft:function(){var e=this,t=e.$refs.scheduleBaseForm;t.validate().then((function(){var t=[];t.push(e.schedule),e.loading=!0,Object(k["a"])(t).then((function(e){g["a"].success({message:"成功",description:"添加成功"})})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){e.loading=!1}))})).catch((function(e){console.debug(e)}))},handleReceivedScheduleOrder:function(e){var t=this,n={ids:[t.schedule.id],result:e,reason:t.reason};t.optLoading=!0,Object(k["c"])(n).then((function(e){200===e.code&&(t.getData(String(t.id),String(t.type)),t.rejectReasonVisible=!1,g["a"].success({message:"成功",description:"已处理"}))})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)})).finally((function(){t.optLoading=!1}))},textFormat:function(e){switch(e){case"draft":return"草稿";case"published":return"已发布";case"confirmed":return"已确认";case"rejected":return"已驳回";case"untreated":return"未处理";case"invalid":return"已作废";default:return e}},dateFormat:function(e){return V()(e).format("YYYY-MM-DD")},importWordConfirm:function(e){var t=e.file,n=new FormData;n.append("file",t),Object(k["g"])(n).then((function(e){g["a"].success({message:"成功",description:"数据导入成功，请至采购记录页面查看"})})).catch((function(e){g["a"].error({message:"错误",description:e}),console.debug(e)}))}}});n("9317"),n("1a00");D.render=O,D.__scopeId="data-v-900ee862";t["default"]=D},"1a00":function(e,t,n){"use strict";n("a7cd")},"346c":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"h",(function(){return s})),n.d(t,"i",(function(){return d})),n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return h})),n.d(t,"j",(function(){return f})),n.d(t,"k",(function(){return p})),n.d(t,"a",(function(){return b}));var c=n("b32d"),o="http://cloud.dowaysoft.com/Gateway/EblService/api/v1/schedule";function r(e){return Object(c["a"])({url:o+"/loadById",method:"get",params:e})}function a(e){return Object(c["a"])({url:o+"/loadByIdReceived",method:"get",params:e})}function s(e){return Object(c["a"])({url:o+"/searchByExp",method:"post",data:e})}function d(e){return Object(c["a"])({url:o+"/searchReceivedByExp",method:"post",data:e})}function i(e){return Object(c["a"])({url:o+"/scheduleImport",method:"post",data:e})}function u(){return Object(c["a"])({url:o+"/queryAll",method:"get"})}function l(){return Object(c["a"])({url:o+"/queryAllReceived",method:"get"})}function h(e){return Object(c["a"])({url:o+"/handleReceivedSchedule",method:"post",data:e})}function f(e){return Object(c["a"])({url:o+"/sendSchedule",method:"post",data:e})}function p(e){return Object(c["a"])({url:o+"/update",method:"post",data:e})}function b(e){return Object(c["a"])({url:o+"/adds",method:"post",data:e})}},"3e16":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return i})),n.d(t,"j",(function(){return u})),n.d(t,"k",(function(){return l})),n.d(t,"a",(function(){return h})),n.d(t,"l",(function(){return f})),n.d(t,"c",(function(){return p})),n.d(t,"g",(function(){return b})),n.d(t,"m",(function(){return m})),n.d(t,"f",(function(){return v}));var c=n("b32d"),o="http://cloud.dowaysoft.com/Gateway/EblService/api/v1/purchase";function r(e){return Object(c["a"])({url:o+"/loadById",method:"get",params:e})}function a(e){return Object(c["a"])({url:o+"/loadByIdReceived",method:"get",params:e})}function s(){return Object(c["a"])({url:o+"/queryAll",method:"get"})}function d(){return Object(c["a"])({url:o+"/queryAllReceived",method:"get"})}function i(e){return Object(c["a"])({url:o+"/searchByExp",method:"post",data:e})}function u(e){return Object(c["a"])({url:o+"/searchByMatExp",method:"post",data:e})}function l(e){return Object(c["a"])({url:o+"/searchReceivedByExp",method:"post",data:e})}function h(e){return Object(c["a"])({url:o+"/adds",method:"post",data:e})}function f(e){return Object(c["a"])({url:o+"/sendPurchaseOrder",method:"post",data:e})}function p(e){return Object(c["a"])({url:o+"/handleReceivedPurchaseOrder",method:"post",data:e})}function b(e){return Object(c["a"])({url:o+"/purchaseImport",method:"post",data:e})}function m(e){return Object(c["a"])({url:o+"/update",method:"post",data:e})}function v(e){return Object(c["a"])({url:o+"/loadMatsByPurchaseId",method:"get",params:e})}},"4e1d":function(e,t,n){},9317:function(e,t,n){"use strict";n("4e1d")},a7cd:function(e,t,n){}}]);